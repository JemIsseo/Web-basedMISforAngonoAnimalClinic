(self.webpackChunk_msnews_msnews_experiences=self.webpackChunk_msnews_msnews_experiences||[]).push([["ms-rewards-wc"],{57695:function(e,t,r){"use strict";r.r(t),r.d(t,{MsRewardsWC:function(){return P},MsRewardsWCStyles:function(){return Z},MsRewardsWCTemplate:function(){return z},ToolingInfo:function(){return ee}});var o=r(33940),a=r(1334),s=r(84169),i=r(41115),n=r(73803);var d;!function(e){e.EdgeChromium="EdgeNTP",e.Windows="WindowsStart"}(d||(d={}));const l="msRewardsCampaign";var u,c;!function(e){e.auto_flyout="auto_flyout"}(u||(u={})),function(e){e.Flyout="0",e.AutoFlyout="2"}(c||(c={}));const h="rewards_redemption_flyout",g="MSRewardsMedallion";var p=r(9500),y=r(12108),m=r(83227),w=r(53076),f=r(31699),v=r(99452),b=r(26415),C=r(19388),F=r(65135),E=r(38156),k=r(9533),x=r(81555),M=r(64193),S=r(33379),T=r(65337),A=r(58958),O=r(77162),L=r(90042),R=r(33954),$=r(65932),I=r(82423);class P extends M.l{constructor(){super(...arguments),this.pageType=y.G.NTP,this.partnerId=d.EdgeChromium,this.channelId=c.Flyout,this.flyoutOpen=!1,this.outsideClickHandler=this.handleOutsideClick.bind(this),this.onMessageHandler=this.onMessage.bind(this),this.flyoutHasOpened=!1,this.autoFlyoutChecked=!1,this.localStorageStamped=!1,this.onFlyoutEvent=(e,t)=>{this.showFlyout&&e!==a.tk.msRewards&&t&&this.toggleFlyout()}}getExperienceType(){return m.x.msRewardsWC}showExperienceChanged(){this.showExperience?this.classList.remove("hidden"):this.classList.add("hidden")}connectedCallback(){super.connectedCallback(),window.addEventListener("message",this.onMessageHandler),(0,a.WW)(this.onFlyoutEvent)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("message",this.onMessageHandler),(0,a.St)(this.onFlyoutEvent)}onMessage(e){if(e&&e.data&&e.data.action)switch(e.data.action){case"resize":this.handleResize(e);break;case"flyoutInternalError":this.handleAutoFlyoutError();break;case"close":this.handleCloseAutoFlyout()}}handleResize(e){if(e.data.bodyHeight){R.k.log(`Height received from rewards flyout: ${e.data.bodyHeight}`);const t=this.shadowRoot.querySelector(".rewards-flyout");t&&t.style&&(t.style.height=e.data.bodyHeight+"px")}else F.M0.sendAppErrorEvent(Object.assign(Object.assign({},b.s8f.RewardsFlyoutBodyHeightMissing),{message:"Rewards flyout didn't return body height"}));(0,C.o_)("RewardsFlyout",!0)}handleAutoFlyoutError(){this.channelId===c.AutoFlyout&&(F.M0.sendAppErrorEvent(Object.assign(Object.assign({},b.s8f.RewardsAutoFlyoutInternalError),{message:"Internal Error message received from rewards auto flyout"})),this.showFlyout&&this.toggleFlyout())}handleCloseAutoFlyout(){this.channelId===c.AutoFlyout&&this.showFlyout&&this.toggleFlyout()}toggleFlyout(e=!1){this.showFlyout=!this.showFlyout,this.showFlyout?(this.flyoutHasOpened||(this.flyoutHasOpened=!0),document.addEventListener("mouseup",this.outsideClickHandler),e?(this.autoFlyoutClass="auto-flyout",this.channelId=c.AutoFlyout):(this.autoFlyoutClass="",this.channelId=c.Flyout)):document.removeEventListener("mouseup",this.outsideClickHandler),(0,a.Gg)(a.tk.msRewards,this.showFlyout)}handleOutsideClick(e){if(e.target.instanceId===m.x.msRewardsWC)return;const t=e.composedPath();(null==t?void 0:t.includes(this))||(this.showFlyout=!1,document.removeEventListener("mouseup",this.outsideClickHandler),(0,a.Gg)(a.tk.msRewards,!1))}experienceConnected(){var e,t;if(!(0,S.N)()){const e="off"!==(0,I.K0)(w.z.ChromiumPageSettings).getCurrentState().currentBackgroundImageType;this.isOnImage=e}this.pageType=null===(t=null===(e=null===s.jG||void 0===s.jG?void 0:s.jG.TrackInfo)||void 0===e?void 0:e.sitePage)||void 0===t?void 0:t.page_type,this.pageType===y.G.Windows&&(this.isOnImage=!1,this.partnerId=d.Windows,this.flyoutClass="win-flyout"),(0,i.N6)("backgroundImage",(e=>{const t="displayed"===e;f.S.queueUpdate((()=>{this.isOnImage=t}))})),this.showExperience=!this.config.hideOnInit,(0,$.Uo)(w.z.RewardsData,(e=>this.updateRewardsData(e))),this.generateTelemetryTags()}updateRewardsData(e){if(this.rewardPoints=e.rewardPoints,(0,O.n2)().then((t=>{const r=(0,n.u6)()&&t&&e.isRewardsUser;this.showExperience=!t||r,this.showExperience&&F.M0.addOrUpdateTmplProperty(g,"0")}),this.logError),!this.autoFlyoutChecked&&this.config.stampAutoFlyout&&(this.checkStorageAndStampTmpl(),e&&e.rewardsEligibility&&e.rewardsEligibility.autoOpen)){if(this.autoFlyoutChecked=!0,!this.config.enableAutoFlyout)return;this.displayFlyout().catch(this.logError)}}generateTelemetryTags(){this.rewardsTelemetryObject=this.telemetryObject.addOrUpdateChild({name:"MicrosoftRewards",type:E.c9.Module,behavior:E.wu.Customize,content:{headline:"Rewards"}}),this.rewardsTelemetryTag=this.rewardsTelemetryObject.getMetadataTag()}shadowDomPopulated(){if(!(0,S.N)())return;const e=this.shadowRoot.getElementById("msRewards");e&&(0,k.FY)(x._.rewardsIcon,e);const t=this.shadowRoot.getElementById("rewards-button");t&&(0,k.FY)(x._.rewardsButton,t),this.markVisuallyReady(),this.showExperience&&F.M0.addOrUpdateTmplProperty(g,"1")}getDarkModeStatus(){return(0,A.Y)()}displayFlyout(){return(0,o.mG)(this,void 0,void 0,(function*(){if(this.flyoutHasOpened)return;(yield this.checkPSLForAutoFlyoutEligibility())&&this.checkCampaignManagerForAutoFlyout()&&(this.toggleFlyout(!0),F.M0.addOrUpdateTmplString("rewards_auto_flyout_displayed"),this.updatePSLForAutoFlyout().catch(this.logError))}))}checkPSLForAutoFlyoutEligibility(){var e;return(0,o.mG)(this,void 0,void 0,(function*(){const t=yield L.S.getLocalCoachmarkCampaignByKeyAndName(l,u.auto_flyout);if(!t)return!0;if((null!==(e=t.count)&&void 0!==e?e:0)>2)return!1;if(!t.time)return!1;return!((new Date).getTime()<t.time+6048e5)}))}checkCampaignManagerForAutoFlyout(){const e={name:l},t=p.i.getInstance();return t&&t.register(e)}updatePSLForAutoFlyout(){return(0,o.mG)(this,void 0,void 0,(function*(){yield L.S.setLocalCoachmarkCampaignByKeyAndName(l,u.auto_flyout,"ntp")}))}checkStorageAndStampTmpl(){if(!this.rewardPoints||this.localStorageStamped)return;this.localStorageStamped=!0;const e="rewards_redemption_flyout_Stamped";(0,T.$o)().getItem(e)?F.M0.addOrUpdateTmplString(h):this.rewardPoints>1500&&(F.M0.addOrUpdateTmplString(h),(0,T.$o)().setItem(e,"true"))}logError(e){R.k.logError(JSON.stringify(e))}}(0,o.gn)([v.LO],P.prototype,"showExperience",void 0),(0,o.gn)([v.LO],P.prototype,"rewardPoints",void 0),(0,o.gn)([v.LO],P.prototype,"isOnImage",void 0),(0,o.gn)([v.LO],P.prototype,"showFlyout",void 0),(0,o.gn)([v.LO],P.prototype,"rewardsTelemetryTag",void 0),(0,o.gn)([v.LO],P.prototype,"flyoutClass",void 0),(0,o.gn)([v.LO],P.prototype,"autoFlyoutClass",void 0);var N=r(49218),_=r(93703),H=r(56334),U=r.n(H);const B=N.dy`<div class="rewards-flyout ${e=>e.flyoutClass} ${e=>e.autoFlyoutClass}" id="rewards-flyout" part="rewardsFlyout"><iframe frameBorder="no" scrolling="no" src="https://www.bing.com/rewardsapp/flyout?channel=${e=>e.channelId}&partnerId=${e=>e.partnerId}&pageType=${e=>e.pageType}&isDarkMode=${e=>e.getDarkModeStatus()?1:0}" title="Microsoft News"></iframe></div>`,G=N.dy`<div class="reward-points ${e=>e.isOnImage?"reward-balance-withoutContrast":"reward-balance-contrast"}">${e=>e.rewardPoints<e.config.thresholdToTruncateRewardPoints?e.rewardPoints:e.config.localizedStrings.truncatedRewardPoints}</div>`,K=N.dy`<fluent-button
class="rewards-button ${e=>e.isOnImage?"img":""}"
appearance="stealth"
data-t="${e=>e.rewardsTelemetryTag}"
@click=${(e,t)=>e.toggleFlyout()}
id="msRewards"
part="rewards-button"
title="${e=>e.strings.accessibility.title}"
aria-label="${e=>e.strings.accessibility.title}"><span>${(0,_.g)((e=>e.rewardPoints),G)}<div class="reward-icon" id="rewards-button">${N.dy.partial(U())}</div></span></fluent-button>${(0,_.g)((e=>e.showFlyout),B)}
`,z=N.dy`
${(0,_.g)((e=>e.showExperience),K)}
`;var j=r(42689),D=r(35680),W=r(71942),V=r(22674),q=r(64434),Y=r(78923);const J=`${q.K.Dialog}`,X=Y.i`
.rewards-flyout{right:100px}.reward-points{float:left;padding-right:7px}`,Q=Y.i`
.rewards-flyout{left:100px}.reward-points{float:right;padding-left:7px}`,Z=Y.i`
:host(.hidden){display:none}.rewards-flyout{box-shadow:0px 25.6px 57.6px rgb(0 0 0 / 13%),0px 0px 16.4px rgb(0 0 0 / 11%);position:fixed;top:72px;width:320px;z-index:${J}}.auto-flyout{width:240px}.win-flyout{position:absolute;top:initial}.reward-balance-contrast{color:${j.C}}.reward-balance-withoutContrast{color:#FFFFFF}.rewards-button{background-color:transparent;width:max-content;margin-top:1px}.rewards-button:focus{border:none;outline:none}.rewards-button:hover{background-color:${D.Xi}}.rewards-button.img:hover{background-color:rgba(17,17,17,0.8)}fluent-button.rewards-button::part(control){padding:0 5px}.rewards-button span{position:relative}.rewards-button svg{height:20px;width:20px}.rewards-flyout iframe{border-radius:4px;height:100%;width:100%}.reward-icon{display:flex;float:left}.img .reward-icon{fill:white}.reward-icon{fill:${j.C}}.title{height:48px;border-bottom:1px solid ${W.dt}}@media screen and (-ms-high-contrast:active){.reward-icon svg,.reward-icon svg path{fill:currentColor}}`.withBehaviors(new V.O(X,Q)),ee={experienceConfigSchema:undefined}},90042:function(e,t,r){"use strict";r.d(t,{S:function(){return c}});var o=r(33940),a=r(65135),s=r(17440),i=r(75192),n=r(26415),d=r(27003),l=r(99590);class u{constructor(e){this.userNurturingManager=e}static getInstance(){return d.Gq.get("__LocalCoachmarkStorageManager__",(()=>new u(s.H.getInstance())))}getAllLocalCoachmarkCampaignsByKey(e){return(0,o.mG)(this,void 0,void 0,(function*(){if(!(yield this.userNurturingManager.isApiAvailableToUse()))return this.sendClientLogEvent(`User's preference for local campaign ${e} could not be fetched.`),this.buildKeyErrorResponse();const t=yield this.userNurturingManager.getPreferenceSetting(e);return t&&t.value}))}getLocalCoachmarkCampaignByKeyAndName(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){if(!(yield this.userNurturingManager.isApiAvailableToUse()))return this.sendClientLogEvent(`User's preference for local campaign ${e} and name ${t} could not be fetched.`),this.buildErrorResponse();const r=yield this.userNurturingManager.getPreferenceSetting(e),o=r&&r.value;return o&&o.find((e=>e&&e.name===t))}))}setLocalCoachmarkCampaignByKeyAndName(e,t,r,a){return(0,o.mG)(this,void 0,void 0,(function*(){if(!(yield this.userNurturingManager.isApiAvailableToUse()))return void this.sendClientLogEvent(`User's preference for local campaign key ${e} and name ${t} could not be set.`);const o=yield this.userNurturingManager.getPreferenceSetting(e),s=o&&o.value?o.value:[],i=s.find((e=>e&&e.name===t)),n=s.indexOf(i),d=i&&i.count||0,l={name:t,count:d+1,source:r,time:a||(new Date).getTime()};n>-1?s[n]=l:s.push(l),this.userNurturingManager.savePreferenceSetting(e,s)}))}clearLocalCoachmarkCampaignByKeyAndName(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){if(!(yield this.userNurturingManager.isApiAvailableToUse()))return void this.sendClientLogEvent(`User's preference for local campaign ${e} and name ${t} could not be cleared.`);const r=yield this.userNurturingManager.getPreferenceSetting(e),o=r&&r.value,a=o&&o.filter((e=>e&&e.name!==t));a&&this.userNurturingManager.savePreferenceSetting(e,a)}))}clearAllLocalCoachmarkCampaignsByKey(e){return(0,o.mG)(this,void 0,void 0,(function*(){(yield this.userNurturingManager.isApiAvailableToUse())?this.userNurturingManager.deleteKeyValueFromPSL(e):this.sendClientLogEvent(`User's preference for local campaign ${e} could not be cleared.`)}))}sendClientLogEvent(e,t){const r={message:e,type:"information",pb:Object.assign(Object.assign({},(0,n.mnt)()),{customMessage:t})};a.M0.sendClientLogEvent(r)}buildKeyErrorResponse(){return[this.buildErrorResponse(!0)]}buildErrorResponse(e=!1){const t=e?"getAllLocalCoachmarkCampaignsByKey":"clearLocalCoachmarkCampaignByKeyAndName";return{count:-1,name:i.rr.apiError,source:t,time:(new Date).getTime()}}}const c=(0,l.h)(u)},56334:function(e){e.exports='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.25 2c.97 0 1.75.78 1.75 1.75v3.04c0 1.03-.57 1.97-1.48 2.44l-6.28 3.28a5 5 0 11-4.48 0L3.48 9.23A2.75 2.75 0 012 6.79V3.75C2 2.78 2.78 2 3.75 2h16.5zM12 13.48a3.5 3.5 0 100 7 3.5 3.5 0 000-7zm3.5-9.98h-7v6.66l3.38 1.77c.08.04.16.04.24 0l3.38-1.77V3.5zM7 3.5H3.75a.25.25 0 00-.25.25v3.04c0 .47.26.9.67 1.11L7 9.38V3.5zm13.25 0H17v5.88l2.83-1.48c.41-.22.67-.64.67-1.1V3.74a.25.25 0 00-.25-.25z"></path></svg>'}}]);