"use strict";(self.webpackChunk_msnews_msnews_experiences=self.webpackChunk_msnews_msnews_experiences||[]).push([["weather-card-data-connector"],{80368:function(e,t,n){function i(e){let t;if(e instanceof URL)t=e.searchParams;else if(e instanceof URLSearchParams)t=e;else if("string"==typeof e)try{t=new URL(e).searchParams}catch(e){t=void 0}return r(t,"ocid")}function r(e,t,n){if(e&&t){const i={value:e.get(t)||void 0};if(!i.value&&n&&n.length>0)for(let t=0;t<n.length&&(i.value=e.get(n[t])||void 0,!i.value);++t);if(!i.value){const n=t.toLowerCase();e.forEach((function(e,t){!i.value&&t.toLowerCase()===n&&e&&(i.value=e)}))}return i.value}}function o(e,t){if(!e)return null;let n;try{n=new URL(e instanceof URL?e.href:e)}catch(e){return null}return n&&t&&t.length&&t.forEach((e=>{n.searchParams.delete(e)})),n.href}function a(e){const t=new RegExp("^.*/([Aa][Rr]||[Ss]{2}||[Vv][Ii]||[Vv][Pp])-(?<contentId>[a-zA-Z0-9]{6,8})(([?].*)||#.*)?$");return null!==e.match(t)}function s(e,t){var n;return(null===(n=i(e))||void 0===n?void 0:n.includes("hpmsn"))&&"windows"!==t}n.d(t,{ku:function(){return i},Ol:function(){return r},jI:function(){return a},D7:function(){return s},jC:function(){return o}});new Set(["msedgdhphdr","msedgntphdr","msedgntp","msedgdhp","entnewsntp"]);n(49977)},53401:function(e,t,n){n.r(t),n.d(t,{ToolingInfo:function(){return le},WeatherCardDataActions:function(){return r},WeatherCardDataConnector:function(){return ae},WeatherCardDataReducer:function(){return ue}});var i=n(55067);class r{}r.updateLocationDisplayName=new i.C("UpdateLocationDisplayName"),r.fetchWeatherSummarySuccess=new i.C("FetchWeatherSummarySuccess"),r.fetchWeatherSummaryFailure=new i.C("FetchWeatherSummaryFailure"),r.updateCurrentLocation=new i.C("UpdateCurrentLocation"),r.updateFallbackStatus=new i.C("updateFallbackStatus"),r.updateLocationDetectionState=new i.C("UpdateLocationDetectionState"),r.updateWeatherUserProfile=new i.C("UpdateWeatherUserProfile"),r.updateHyperlocal=new i.C("updateHyperlocal"),r.updateWeatherSettings=new i.C("UpdateWeatherSettings"),r.updateOperationFailure=new i.C("updateOperationFailure"),r.hideWeatherCard=new i.C("HideWeatherCard"),r.toggleFeedbackDialog=new i.C("ToggleFeedbackDialog");var o=n(33940),a=n(29422),s=n(38985),c=n(24787),u=n(30854),l=n(38573),d=n(81368),h=n(17793),f=n(2434),g=n(88096),v=n(44979),p=n(73252),m=n(94788),y=n(65337),S=n(68742),L=n(68364),w=n(26415),C=n(33954),A=n(24474),b=n(9601),O=n(63439),D=n(41710),F=n(5309),W=n(33799),N=n(65135),P=n(66900),U=n(51325),j=n(80569),I=n(33379);class G{constructor(e){this.dc=e}addFavorite(e){var t;return(0,o.mG)(this,void 0,void 0,(function*(){const n=yield this.dc.pdpserviceClient.addFavoriteLocation(e);if(n){const n=(0,c.qF)(this.dc.getCurrentState().profile,e);null===(t=r.updateWeatherUserProfile.getActionSender(this.dc))||void 0===t||t.send(n)}return n}))}setHome(e){var t,n;return(0,o.mG)(this,void 0,void 0,(function*(){const i=[];i.push(this.dc.pdpserviceClient.setHomeLocation(e).then((e=>!!e))),i.push(this.dc.pdpserviceClient.updateUserSettings(null,2..toString()));const o=(yield Promise.all(i)).every((e=>!!e));if(o){let i=this.dc.getCurrentState().profile;const o=this.dc.getCurrentState().currentLocation;a.dP(o,e)||null==(null==o?void 0:o.from)||(null==o||delete o.from,null===(t=r.updateCurrentLocation.getActionSender(this.dc))||void 0===t||t.send(o));const s=i.home;i.home=e,i.home.from=3,i.locationMode=2,s&&(delete s.from,i=(0,c.Vn)(i,s),this.dc.setRecentLocations(i.recents)),null===(n=r.updateWeatherUserProfile.getActionSender(this.dc))||void 0===n||n.send((0,c.qq)(i))}return o}))}updateWeather(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){const n=this.dc.getCurrentState().unit;return yield this.fetchWeather(e,n,t)}))}fetchWeather(e,t,n){return(0,o.mG)(this,void 0,void 0,(function*(){!e||(0,l.JY)(e)||e.el||(C.k.log("ignore Invalid input location: "+JSON.stringify(e)),e=void 0),t&&t!==S.a.Celsius&&t!==S.a.Fahrenheit&&(t=void 0);const i=e||{},r=t,o=(n=n||{})||{},a=Object.assign(Object.assign(Object.assign(Object.assign({},o.disableFetchRegionData&&{requestInfo:{disableFetchRegionData:o.disableFetchRegionData}}),o.filterRuleValue&&{filterRule:o.filterRuleValue}),n.partialHourly&&n.partialHours&&{partialHours:n.partialHours}),{partialHourly:n.partialHourly,hourlyStartDay:n.hourlyStartDay,hourlyDataDays:n.hourlyDataDays,userProfileFetch:n.userProfileFetch,lifeDataDays:n.lifeDataDays});return this.fetchWeatherDataAndLocationNameWithFallback(i,r,o,a)}))}fetchWeatherDataAndLocationNameWithFallback(e,t,n,i){return(0,o.mG)(this,void 0,void 0,(function*(){try{if(yield this.fetchWeatherDataAndLocationName(e,t,n,i))return!0;(null==n?void 0:n.isRefresh)||this.dc.sendFetchWeatherSummaryFailureAction()}catch(e){return this.fetchWeatherDataAndLocationNameWithBLIS(t,n,i)}}))}fetchWeatherDataAndLocationName(e,t,n,i){var u,l;return(0,o.mG)(this,void 0,void 0,(function*(){i=i||{};const o=yield new Promise(((n,r)=>{let o=0,a={};const c=()=>a.forecast&&a.location?n(a):2===o?r(new Error("Failed to fetch Weather forecast or location")):void 0;this.resolveWeatherData(e,t,i).then((e=>{++o,a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a),e&&e.forecast&&{forecast:e.forecast}),e&&e.home&&{home:e.home}),{location:e&&e.location||a.location}),e&&e.profile&&{profile:e.profile}),c()})).catch((n=>{var r;let u=(0,I.N)()?w.z$F:w.zEz;"scard"===(null===(r=null==i?void 0:i.requestInfo)||void 0===r?void 0:r.experience)&&(u=w.XI8),(null==i?void 0:i.preventLogExceptionOnFailure)||(0,L.OO)(n,u,"error in library [weather-card-data-connector],error in library [weather-card-data-connector],Unexpected process weather summary data error",`${(0,s.f6)(e)}, unit=${t}, res=${JSON.stringify(a)}`),++o,c()})),this.resolveLocationName(e).then((e=>{++o,a.location=a.location||e,c()})).catch((t=>{(0,L.OO)(t,w._Y2,"error in library [weather-card-data-connector],Unexpected process localize display name error",`${(0,s.f6)(e)}`),++o,c()}))}));if(o&&o.forecast&&o.location){if((0,I.N)())o.forecast.currentCondition=Object.assign(Object.assign({},o.forecast.currentCondition),{deepLink:(0,j.DF)(o.location,o.forecast.unit)});else{const e=(0,v.Nd)(this.dc.requestContext.data.locationHref,"locationHref");o.forecast.currentCondition=Object.assign(Object.assign({},o.forecast.currentCondition),{deepLink:(0,j.DF)(o.location,o.forecast.unit,{locationHref:e})})}o.location.displayName=a.Gf(o.location),null===(u=r.fetchWeatherSummarySuccess.getActionSender(this.dc))||void 0===u||u.send(o.forecast,o.location,o.forecast.unit,void 0,n.historyFetch);let e=this.dc.getCurrentState().profile;e.unit=o.forecast.unit;const t=o.profile&&o.profile.followedLocations&&o.profile.followedLocations.filter((e=>!!e&&(0,s.CR)(e)));return t&&t.length>0&&!(e.followedLocations&&e.followedLocations.length>0)&&(e.followedLocations=(0,c.LV)(t)),(0,I.N)()&&(n.bySearch&&(e=(0,c.Vn)(e,o.location),this.dc.setRecentLocations(e.recents),e.recentsForMobile=(0,c.Oj)(e,o.location)),this.dc.updateHyperlocal()),null===(l=r.updateWeatherUserProfile.getActionSender(this.dc))||void 0===l||l.send(e),!0}return!1}))}fetchWeatherDataAndLocationNameWithBLIS(e,t,n){return(0,o.mG)(this,void 0,void 0,(function*(){try{const i=yield this.dc.getBLISLocation(),r=Object.assign({},n);r.readChoice=e?0:2;if(yield this.fetchWeatherDataAndLocationName(i,e,t,r))return!0;(null==t?void 0:t.isRefresh)||this.dc.sendFetchWeatherSummaryFailureAction()}catch(e){(null==t?void 0:t.isRefresh)||this.dc.sendFetchWeatherSummaryFailureAction()}}))}resolveWeatherData(e,t,n){var i,c,u;return(0,o.mG)(this,void 0,void 0,(function*(){let o=yield this.getWeather(e,t,n);const l=this.dc&&this.dc.config&&this.dc.config.defaultLocation?this.dc.config.defaultLocation:void 0;if(o&&o.location&&!(0,s.a7)(o.location)&&(o.location=yield this.resolveLocationName(o.location)),o&&o.location&&"{}"!==JSON.stringify(o.location)||!l){const e=o&&o.location?o.location:void 0;e&&l&&!a.dP(e,(0,s.qE)())&&a.dP(e,l)?null===(c=r.updateFallbackStatus.getActionSender(this.dc))||void 0===c||c.send(!0):null===(u=r.updateFallbackStatus.getActionSender(this.dc))||void 0===u||u.send(!1)}else n.preventLogExceptionOnFailure=!0,o=yield this.getWeather(l,t,n),o&&o.location&&(o.location=yield this.resolveLocationName(o.location)),null===(i=r.updateFallbackStatus.getActionSender(this.dc))||void 0===i||i.send(!0);return o}))}resolveLocationName(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){if((0,P.wf)(e))return yield this.resolveMiniProgramDetectedLocationName(e,t);let n;return a.Gf(e)&&(n=e),n&&a.Gf(n)||(n=(0,c.sE)(this.dc.getCurrentState().profile,e.latitude,e.longitude)),n&&a.Gf(n)&&(0,s.bd)(n)||(n=(yield this.dc.localizeLocationService.getLocalisedLocationDetails(e,t))||n),n?(n.displayName=a.Gf(n),n):e}))}getWeather(e,t,n){return(0,o.mG)(this,void 0,void 0,(function*(){const i=yield this.dc.serviceClient.getWeather(e,t,n);return i&&i.forecast?i:null}))}resolveMiniProgramDetectedLocationName(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){let n;if(e){if(e.displayName)return(0,U.VO)(e),e;const i=(0,U.qB)();if((0,l.XA)(i,e)&&(null==i?void 0:i.displayName))return i;if(n=(0,c.sE)(this.dc.getCurrentState().profile,e.latitude,e.longitude),n&&n.displayName&&(0,s.bd)(n)||(n=(yield this.dc.localizeLocationService.getLocalisedLocationDetails(e,t))||n),n)return n.displayName=a.Gf(n),(0,U.VO)(n),n}}))}}var R=n(38759),E=n(4596),k=n(32050),x=n(84169),M=n(19809),H=n(87298),T=n(22704),$=n(89696),q=n(43212);function V(e=((0,I.N)()?navigator.userAgent:null)){return!!e&&(-1!==e.indexOf("Yahoo")||-1!==e.indexOf("Yandex")||-1!==e.indexOf("Baiduspider")||-1!==e.indexOf("Bingbot")||-1!==e.indexOf("Googlebot"))}var _=n(46102);const z={isVisualReady:!1,data:{}};function B(){z.isVisualReady=!0;const e=z.data;z.data={},Object.keys(e).length>0&&N.M0.sendLoadTimeEvent({markers:e})}var J=n(82530);const Y="https://assets.msn.com",K="weatherfalcon/weather/overview",X="segments/recoitems/weather",Q={msnewsprodks:"KoreaSouth",msnewsprodneu:"NorthEurope",msnewsprodwus:"WestUS2",msnewsprodeus:"EastUS2"};var Z;!function(e){e[e.Not_Detected=1]="Not_Detected",e[e.Overview=2]="Overview",e[e.OverviewUser=3]="OverviewUser",e[e.SegmentOverview=4]="SegmentOverview"}(Z||(Z={}));class ee extends class{constructor(e,t,n){this.fetchImpl=e,this.config=t,this.locationHref=n,this.schemaTranslator=new q.vI(t.truncateTimezone,n)}}{shouldAttachCookie(e,t){return!this.config.isFailOverHost&&("zh-cn"!==e&&!(!t||!t.readChoice&&!t.saveChoice))}getWeather(e,t,n){var i;return(0,o.mG)(this,void 0,void 0,(function*(){e=e||{},n=n||{};const r=x.jG.LocaleContentMarket,o=r.language+"-"+r.market,{serviceUrl:a}=function(e,t){const{weatherApi:{path:n,endpoint:i}}=e;let r,o;const a=n===X?4:2;if(V()&&2===a)return r=Y,o=K,{serviceUrl:ie(r,o,t),variant:a};return r=i,o=n||K,{serviceUrl:ie(r,o,t),variant:a}}(this.config,o),s=a.pathname,c=a.searchParams,u=yield M.$.getBaseRequestData("GET");var l;(this.shouldAttachCookie(o,n)||n.includeCookie||this.config.weatherApi.includeCookie)&&(u.credentials="include"),l="prg-wea-falreg",p.Al.CurrentFlightSet&&p.Al.CurrentFlightSet.has(l)&&!(0,I.N)()&&J&&J.env&&J.env.CLUSTER_NAME&&(u.headers=Object.assign(Object.assign({},u.headers||{}),{"X-Falcon-TenantRegion":null!==(i=Q[J.env.CLUSTER_NAME])&&void 0!==i?i:""})),(0,I.N)()||(u.headers=Object.assign(Object.assign({},u.headers||{}),function(){var e;const t={},n=p.Al.ClientSettings;return n&&(null===(e=n.detection)||void 0===e?void 0:e.ip)&&(t["X-MSEdge-ClientIP"]=n.detection.ip),t}())),u.referrerPolicy="no-referrer-when-downgrade";const d=function(e,t,n,i,r,o,a){const{appId:s,apiKey:c,ocid:u,includenowcasting:l,days:d,partialHours:h,noDynamicQueryParams:f,includemapsmetadata:g,includecommentary:v,nowcastingv2:m,alertDistanceinkm:y,bypassCache:L,usemscloudcover:w,cutHour:C,regionCategories:A,features:b,fdhead:O,showRainDistance:D,lifeDays:F,lifeModes:W,includeSwArea:N,includeActivity:P,includestorm:U}=n.weatherApi;M.$.getCommonParams2(u,!1).forEach((e=>{t.set(e.key,e.value)})),r&&t.set("units",r===S.a.Fahrenheit?"F":"C"),ne(t,"appId",s),t.set("apikey",c),t.set("wrapodata","false"),te(t,"includenowcastingdistance",D),te(t,"includemapsmetadata",g),te(t,"bypassCache",L),te(t,"nowcastingv2",m),te(t,"usemscloudcover",w),te(t,"cuthour",C),te(t,"includecommentary",v),te(t,"getCmaAlert","zh-cn"===a&&n.apiGetCmaRegionAlert),ne(t,"regioncategories",A),ne(t,"feature",(b||[]).join(",")),ne(t,"filterRule",i.filterRule),te(t,"includenowcasting",l)&&ne(t,"nowcastingapi","2");ne(t,"lifeDays",F),ne(t,"lifeModes",W),te(t,"includeSwArea",N),te(t,"includestorm",U),(0,_.bc)()&&te(t,"includeActivity",P);"ActivityPlanner"===i.lifeTopic&&te(t,"includeActivity",!0);if(e){const n=new URL(e);if(o.indexOf("private")>=0){const e=n.searchParams.get("env");t.set("env",e)}const i=n.searchParams.get("day");i&&parseInt(i)>1&&t.set("lifeDays",i)}const{disableFetchRegionData:j,experience:G,isStaleRefresh:R}=i.requestInfo||{};j||(t.set("distanceinkm",y||"0"),t.set("regionDataCount","20"),t.set("orderby","distance"));d&&(t.set("days",d),t.set("pageOcid",M.$.getOneServiceOCID(x.jG.TrackInfo,"peregrine")),ne(t,"source",G&&G+(R?"1":"0")));t.set("source",`${p.Al.ClientSettings.verticalKey}_${(0,I.N)()?"csr":"ssr"}`);const E=(i.partialHours||h)&&i.partialHourly,k=E&&i.hourlyStartDay-1>0;ne(t,"hours",E&&(i.partialHours||h)),ne(t,"startday",k&&(i.hourlyStartDay<=10&&i.hourlyStartDay>=1?i.hourlyStartDay-1:0)),i.hourlyDataDays&&!d&&t.set("days",i.hourlyDataDays);i.lifeDataDays&&t.set("lifeDays",i.lifeDataDays);const H=function(e,t){const n=[];if(p.Al.CurrentFlightSet){const e="prg-dualauth";p.Al.CurrentFlightSet.has(e)&&(n.push(e),n.push("1s-jwtuserauth"));const t="prg-1sw-wxwdicon";p.Al.CurrentFlightSet.has(t)&&n.push(t);const i="prg-1sw-wxprate";p.Al.CurrentFlightSet.has(i)&&n.push(i);const r="prg-1sw-nonzeropp";p.Al.CurrentFlightSet.has(r)&&n.push(r)}t.additionalFdHead&&n.push(...t.additionalFdHead.split(","));return 0==n.length?e:e?`${e},${n.join(",")}`:`${n.join(",")}`}(O,i);H?t.set("fdhead",H):t.delete("fdhead");i.sfParams&&t.set("sf",i.sfParams);const T=n.weatherApi.queries||{};for(let[e,n]of Object.entries(T))"{market}"===n&&(n=a),t.set(e,n);f&&(t.delete("user"),t.delete("activityId"));return k}(this.locationHref,c,this.config,n,t,a.host,o);!function(e,t,n,i,r){e.set("region",i.market),e.set("market",(n.isoCode||i.market).toUpperCase()),e.set("locale",r),n&&n.latitude&&n.longitude&&(e.set("lat",n.latitude),e.set("lon",n.longitude));let o=r;"ru-xl"===o&&(o="en-xl");e.set("market",o)}(c,0,e,r,o),function(e,t,n){if(t.enableMockWeatherApiV2){const t=new URL(n).searchParams.get("testCaseId");t&&e.set("id",t)}}(c,this.config,this.locationHref);const{experience:h}=n.requestInfo||{},f=yield this.sendApiRequest(a,u,h,e,n);if(null===f)return null;if(f.status&&(0,I.N)()){const e=w.kKw;(0,L.OO)(Error("Request failure but retry success"),e,f.status+","+s,`Request url: [${a.href}].`)}try{const e=this.schemaTranslator.TranslateToWeatherOverview(f.weatherSummary,f.usedLocation,this.config,d),t=function(e){var t,n;const i={},r=e&&e.userProfile;if(!r)return i;return i.followedLocations=(null===(n=null===(t=r.followedLocations)||void 0===t?void 0:t.map((e=>ee.convert(e))))||void 0===n?void 0:n.filter((e=>!!e)))||[],i.detectedLocation=ee.convert(r.autoDetected),i.sig=r.sig,i}(f.weatherSummary);return{home:void 0,location:f.usedLocation,forecast:e,profile:t}}catch(e){return(0,L.OO)(e,f.weatherDataFetchError,"error in library [weather-shared],Failed to translate overview: "+JSON.stringify(f.weatherSummary)),null}}))}sendApiRequest(e,t,n,i,r){var a,s;return(0,o.mG)(this,void 0,void 0,(function*(){const c={weatherSummary:void 0,weatherDataFetchError:null,status:void 0,usedLocation:void 0},l=e.pathname;c.weatherDataFetchError="scard"===n?w.XI8:(0,I.N)()?w.z$F:w.zEz;try{let n;if(c.weatherSummary=yield(0,H.w)((()=>(0,o.mG)(this,void 0,void 0,(function*(){let r;try{const i=(0,T.UE)();(0,$.hf)(u.YV.overviewRequestStart,i),(0,$.hf)(u.YV.overviewRequestPathHash,function(e){let t=0;for(let n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}(e.pathname)),r=yield this.fetchImpl(e.href,t,function(){if(!(0,I.N)()){const e=(0,k.cb)();return e.trackApiClusterInServer=!0,e}}()),n=(0,T.UE)()-i,function(e,t,n){(0,I.N)()&&(z.data[(e+t).toLowerCase()]=n,z.isVisualReady&&B())}(e.host,e.pathname,Math.round(n)),(0,$.hf)(u.YV.overviewRequestDuration,n)}catch(e){throw c.status=e&&e.toString(),e}if(!r.ok){if(c.status=`code=${r.status}, ${r.statusText}`,r.status>=400&&r.status<=500&&408!=r.status)return{isError:!0,errorCode:r.status};throw Error(r.statusText)}if(!(0,I.N)()&&r.headers){const e=r.headers.get("onewebservicelatency"),t=e?+e:-1;-1!=t&&((0,$.hf)(u.YV.overviewRequestInternal,t),(0,$.hf)(u.YV.overviewRequestNetwork,n-t))}const o=yield this.parseApiResponse(r,e,i);return c.usedLocation=o.usedLocation,o.weatherData}))),l),null===(a=c.weatherSummary)||void 0===a?void 0:a.isError)throw Error(c.status)}catch(t){if(r.preventLogExceptionOnFailure)return null;c.status||(c.status=t&&t.toString());const{experience:n}=r.requestInfo||{};n&&(c.status=n+":"+c.status);const o=`Request url: [${e.href}]. Error detail: [${t&&t.toString()}]`;if(V((0,I.N)()?navigator.userAgent:null))(0,L.OO)(t,w.JIJ,"error in library [weather-shared],"+c.status+","+l,o);else if(this.config.enableMockWeatherApiV2)(0,L.OO)(t,w.TyD,"error in library [weather-shared],"+c.status+","+l,o);else if(422===(null===(s=c.weatherSummary)||void 0===s?void 0:s.errorCode)){const n=`Request url: [${e.href}]. Error detail: [${t&&t.toString()}]. Location: [lat=${i.latitude}, lon=${i.longitude}]`;(0,L.OO)(t,w.A0i,"error in library [weather-shared],"+c.status+","+l,n)}else c.status.indexOf("404")>-1&&(c.weatherDataFetchError=w.pBE),(0,L.OO)(t,c.weatherDataFetchError,"error in library [weather-shared],"+c.status+","+l,o);return null}return c}))}parseApiResponse(e,t,n){var i,r,a,c,u;return(0,o.mG)(this,void 0,void 0,(function*(){const o={weatherData:void 0,usedLocation:n};if(t.pathname.indexOf("segments")>-1){const t=function(e){try{const t=JSON.parse(e[0].data),n=t.userProfile.location,i="2"===t.userProfile.locationSettingMode,r=(n.Language||p.Al.Locale).toLocaleLowerCase();return[t,{addressLine:n.AddressLine,subRegion:n.SubRegion,locality:n.City,region:E.x_(n.State,r,n.CountryCode),country:n.Country,postalCode:n.PostalCode,isoCode:n.CountryCode,from:i?2:void 0,language:r,latitude:""+n.Latitude,longitude:""+n.Longitude}]}catch(e){throw new Error("invalid SegmentStore api response: "+e.stack)}}(yield e.json());return o.weatherData=t[0],o.usedLocation=t[1],o}o.weatherData=yield e.json();const l=ee.convert(o.weatherData.userProfile&&o.weatherData.userProfile.default);if(!(0,s.CR)(n)||n.isDetected&&!n.isBlisDetected)if(null===t.searchParams.get("lat")&&null===t.searchParams.get("lon")&&l)o.usedLocation=l;else if(!x.jG.isMobile){const e=null===(a=null===(r=null===(i=o.weatherData.responses)||void 0===i?void 0:i[0])||void 0===r?void 0:r.source)||void 0===a?void 0:a.coordinates,t={latitude:null===(c=null==e?void 0:e.lat)||void 0===c?void 0:c.toString(),longitude:null===(u=null==e?void 0:e.lon)||void 0===u?void 0:u.toString(),isDetected:!0};t&&(o.usedLocation=t)}return o}))}static convert(e){if((e=E.zW(e,{ISOCode:"isoCode"}))&&e.geoCoordinates){const t=(e.language||(0,s.eK)(e.locationTypeId)||p.Al.Locale).toLocaleLowerCase();return{addressLine:e.addressLine,subRegion:e.subRegion,locality:e.city,region:E.x_(e.state,t,e.isoCode),country:e.countryRegion,postalCode:e.postalCode,isoCode:e.isoCode,locationTypeId:e.locationTypeId,definitionName:e.definitionName,from:4,locationType:e.locationType,language:t,latitude:""+e.geoCoordinates.latitude,longitude:""+e.geoCoordinates.longitude}}}}function te(e,t,n){return n&&e.set(t,"true"),n}function ne(e,t,n){n&&e.set(t,`${n}`)}function ie(e,t,n){return(0,I.N)()?(e.indexOf("assets.msn.")>=0?(t.indexOf("service/")<0&&(t="service/"+t),"zh-cn"===n&&(e=e.replace(".msn.com",".msn.cn"))):t=t.replace("service/",""),new URL(t,e)):(e="https://api.msn.com",t=t.replace("service/",""),new URL(t,e))}var re=n(51671),oe=n(4734);class ae extends O.e{constructor(e,t,n,i,r,o,a){super(e,t,n,i,r,o,a),this.locationHyperCache=new Map,this.getWeatherLocationAndUnit=null;const s=(0,g.j)();this.url=(0,v.DO)(a),this.localizeLocationService=new F.m(s,o.weatherApi),this.autoSuggestService=(0,A.b)(o.autoSuggest),this.pdpserviceClient=new R.v,this.signInStatus=W.Hy.Unknown,this.defaultConfigUnit=this.config.setDefaultUnitToCelsius?S.a.Celsius:S.a.Fahrenheit,(0,I.N)()&&(0,oe.F_)().then((()=>{B()})),this.serviceClient=function(e,t,n){return t.weatherApi?new ee(e,t,n):void 0}(s,o,this.url),this.operation=new G(this)}getAutoSuggestResponse(e,t=!0){return(0,o.mG)(this,void 0,void 0,(function*(){try{const n=yield this.autoSuggestService.getAutoSuggestResponse(e,t);if(n)return n.forEach((e=>e.autoSuggestionName=a.Or(e))),n}catch(e){t&&(0,L.OO)(e,w.H4x,`error in library [weather-card-data-connector],Autosuggest service call exception, useAutoSuggestionV6=${this.config.autoSuggest&&this.config.autoSuggest.useV6}`)}return null}))}geocodeLocation(e){return(0,o.mG)(this,void 0,void 0,(function*(){return yield this.autoSuggestService.geocodeSuggestion(e)}))}getLocalizedDetectedLocation(){return(0,o.mG)(this,void 0,void 0,(function*(){let e=yield this.getBLISLocation();return e&&!(0,s.bd)(e)&&(e=yield this.localizeLocationService.getLocalisedLocationDetails(e)),e}))}addFavoriteLocation(e){var t,n,i,a;return(0,o.mG)(this,void 0,void 0,(function*(){if(((null===(n=null===(t=this.getCurrentState().profile)||void 0===t?void 0:t.favorites)||void 0===n?void 0:n.length)||0)>=c.By)return null===(i=r.updateOperationFailure.getActionSender(this))||void 0===i||i.send(u.Uh.exceedPinLocationLimit),!1;const o=yield this.operation.addFavorite(e);return this.setRecentLocations(null===(a=this.getCurrentState().profile)||void 0===a?void 0:a.recents),o}))}fetchActiveStateforWeather(e,t,n,i={}){return(0,o.mG)(this,void 0,void 0,(function*(){return!1===t?this.fetchActiveLocationAndUnit(e).then((e=>null==e?void 0:e[0])):this.fetchSettingAndUpdateWeather(e,n,i).then((e=>null==e?void 0:e[0]))}))}isLocationAndUnitReusable(){if(this.getWeatherLocationAndUnit&&ae.getWeatherLocationAndUnitTime){if(Math.trunc((Date.now()-ae.getWeatherLocationAndUnitTime)/6e4)<3)return!0}return!1}fetchSettingAndUpdateWeather(e,t,n={}){return(0,o.mG)(this,void 0,void 0,(function*(){if(!e&&this.isLocationAndUnitReusable())return this.getWeatherLocationAndUnit;ae.getWeatherLocationAndUnitTime=Date.now();const i=this.getCurrentState().currentLocation;let a=i,s=this.defaultConfigUnit,u=!1;return this.getWeatherLocationAndUnit=new Promise((e=>(0,o.mG)(this,void 0,void 0,(function*(){var o,l;try{let e=!0;a=this.getURLLatLngLocation(),a||(e=!1,a=(yield this.getBLISLocation())||a),yield this.updateSignedInStatus();const t=yield this.pdpserviceClient.read(n),i=t.followedLocations,d=this.getCurrentState().profile||{},h=yield this.getBLISLocation();d.followedLocations=(0,c.LV)(i).slice(0,c.By),d.detectedLocation=h,null===(o=r.updateWeatherUserProfile.getActionSender(this))||void 0===o||o.send(d),t&&(e||(t.locationMode&&(u=1===t.locationMode),u?(a=h,null===(l=r.updateLocationDetectionState.getActionSender(this))||void 0===l||l.send(1,a)):t.home&&(a=t.home)),t.unit&&(s=t.unit))}catch(e){(0,L.OO)(e,w.OPi,"error in library [weather-card-data-connector],error in library [weather-card-data-connector],Weather Location fetch failed")}i&&i.displayName&&a&&i.latitude===a.latitude&&i.longitude===a.longitude&&i.locality===a.locality&&(a.displayName=i.displayName),e([a,s]),a||N.M0.sendAppErrorEvent(Object.assign(Object.assign({},w.OPi),{message:"Weather Location fetch failed with empty activeWeatherLocation",pb:Object.assign(Object.assign({},w.OPi.pb),{customMessage:`Geo Latitude = ${p.Al.ClientSettings&&p.Al.ClientSettings.geo_lat},\n                            & Geo Longitude =  ${p.Al.ClientSettings&&p.Al.ClientSettings.geo_long}`})})),a&&this.getWeatherForecastDataAndLocationName(a,s,t)})))),this.getWeatherLocationAndUnit}))}fetchActiveLocationAndUnit(e){return(0,o.mG)(this,void 0,void 0,(function*(){if(this.getWeatherLocationAndUnit&&!e)return this.getWeatherLocationAndUnit;let t=this.getCurrentState().currentLocation,n=this.defaultConfigUnit;return this.getWeatherLocationAndUnit=new Promise((e=>(0,o.mG)(this,void 0,void 0,(function*(){try{if(t=(yield this.getBLISLocation())||t,t.displayName=a.Gf(t),yield this.updateSignedInStatus(),this.isUserLoggedIn()){const e=yield this.pdpserviceClient.read();e&&(e.home&&(t=e.home),e.unit&&(n=e.unit))}}catch(e){(0,L.OO)(e,w.OPi,"error in library [weather-card-data-connector],Weather Location fetch failed")}e([t,n]),t||N.M0.sendAppErrorEvent(Object.assign(Object.assign({},w.OPi),{message:"Weather Location fetch failed with empty activeWeatherLocation",pb:Object.assign(Object.assign({},w.OPi.pb),{customMessage:`Geo Latitude = ${p.Al.ClientSettings&&p.Al.ClientSettings.geo_lat},\n                            & Geo Longitude =  ${p.Al.ClientSettings&&p.Al.ClientSettings.geo_long}`})})),t&&this.getWeatherForecastDataAndLocationName(t,n)})))),this.getWeatherLocationAndUnit}))}updateSettings(e,t,n,i,a,c={},l=!1){var d,h,f,g,v;return(0,o.mG)(this,void 0,void 0,(function*(){let o=2===e&&t&&""!==t.latitude&&""!==t.longitude;const p=e&&e!==this.getCurrentState().locationDetectionSetting;o&&this.getCurrentState().currentLocation&&!p&&(o=!((null==t?void 0:t.latitude)===(null===(d=this.getCurrentState().currentLocation)||void 0===d?void 0:d.latitude)&&(null==t?void 0:t.longitude)===(null===(h=this.getCurrentState().currentLocation)||void 0===h?void 0:h.longitude)));const y=n&&n!==this.getCurrentState().unit;n||(n=this.getCurrentState().unit||this.defaultConfigUnit),t&&""!==t.latitude&&""!==t.latitude||(t=this.getCurrentState().currentLocation);const{profile:S}=this.getCurrentState();S&&t&&(S.followedLocations?S.followedLocations=[t,...S.followedLocations.filter((e=>!(0,s.eu)(t,e)))].slice(0,10):S.followedLocations=[t]),1===e?(t=yield this.getBLISLocation(),null===(f=r.updateLocationDetectionState.getActionSender(this))||void 0===f||f.send(1,t,new Date),(0,b.ye)(t)):null===(g=r.updateLocationDetectionState.getActionSender(this))||void 0===g||g.send(e,t,new Date);const L=[];return!1!==i&&((o||l)&&L.push(this.pdpserviceClient.setHomeLocation(t,c).then((()=>{var e,t;const n=null===(e=this.getCurrentState().profile)||void 0===e?void 0:e.home,i=null===(t=this.getCurrentState().profile)||void 0===t?void 0:t.locationMode;n&&2===i&&this.addFavoriteLocation(n)}))),(y||p)&&L.push(this.pdpserviceClient.updateUserSettings(y?n.toString():null,p?e.toString():"",c))),yield Promise.all(L),null===(v=r.updateWeatherSettings.getActionSender(this))||void 0===v||v.send(u.SU.Start),a||(0,m.mS)({id:"InvalidateWeatherPdp",type:"command"}),t}))}updateSettingsAndFetch(e,t,n,i,r,a,s={}){return(0,o.mG)(this,void 0,void 0,(function*(){return t=yield this.updateSettings(e,t,n,i,!0,s),yield this.getWeatherForecastDataAndLocationName(t,n,a),r||(0,m.mS)({id:"InvalidateWeatherPdp",type:"command"}),t}))}updateSignedInStatus(){return(0,o.mG)(this,void 0,void 0,(function*(){if(this.signInStatus===W.Hy.Unknown){const e=new Date;this.signInStatus=yield(0,re.XJ)(),D.s.signedInStatus.registerObserver((t=>(0,o.mG)(this,void 0,void 0,(function*(){if(!this.isUserLoggedIn()&&(this.signInStatus=yield(0,re.XJ)(),this.isUserLoggedIn())){const t=new Date;C.k.log(`Time of login:${JSON.stringify((t.getTime()-e.getTime())/1e3)} seconds`),this.fetchActiveStateforWeather(!0)}}))))}}))}isUserLoggedIn(){return this.signInStatus===W.Hy.SignedIn}updateLocationDisplayName(e){var t,n,i;return(0,o.mG)(this,void 0,void 0,(function*(){if(e&&a.Gf(e)&&(0,s.bd)(e))return void(null===(t=r.updateLocationDisplayName.getActionSender(this))||void 0===t||t.send(e));if(!(0,l.JY)(e))return void N.M0.sendAppErrorEvent(Object.assign(Object.assign({},w.OPi),{message:"No valid User location set "}));const o=yield this.localizeLocationService.getLocalisedLocationDetails(e);if(o){const e=(0,c.Vn)(this.getCurrentState().profile,o);this.setRecentLocations(e.recents),e.recentsForMobile=(0,c.Oj)(this.getCurrentState().profile,o),null===(n=r.updateWeatherUserProfile.getActionSender(this))||void 0===n||n.send(e),null===(i=r.updateLocationDisplayName.getActionSender(this))||void 0===i||i.send(o)}}))}getWeatherForecastDataAndLocationName(e,t,n){var i;return(0,o.mG)(this,void 0,void 0,(function*(){try{const i=yield this.getWeatherForecastData(e,t,n);return i&&this.updateLocationDisplayName(e),i}catch(e){let t=w.z$F;return"scard"===(null===(i=null==n?void 0:n.requestInfo)||void 0===i?void 0:i.experience)&&(t=w.XI8),(0,L.OO)(e,t,"error in library [weather-card-data-connector],error in library [weather-card-data-connector],Failure to parse weather response"),!1}}))}getWeatherForecastData(e,t,n){var i,a,s,d;return(0,o.mG)(this,void 0,void 0,(function*(){if(!(0,l.JY)(e))return N.M0.sendAppErrorEvent(Object.assign(Object.assign({},w.OPi),{message:"No valid User location set"})),!1;const o=yield this.getWeather(e,t,n);if(!o)return!1;const h=o.forecast,f=(0,c.Vn)(this.getCurrentState().profile,e);f.unit=t,this.setRecentLocations(f.recents),f.recentsForMobile=(0,c.Oj)(this.getCurrentState().profile,e),f.sig=null===(i=o.profile)||void 0===i?void 0:i.sig,null===(a=r.updateWeatherUserProfile.getActionSender(this))||void 0===a||a.send(f);return this.getCurrentState().settingUpdateStatus!=u.SU.WCComplete&&("wcardwc"===(null===(s=null==n?void 0:n.requestInfo)||void 0===s?void 0:s.experience)&&h&&(h.lastUpdated=Date.now().toString()),null===(d=r.fetchWeatherSummarySuccess.getActionSender(this))||void 0===d||d.send(h,e,t),!0)}))}updateWeatherDataState(e,t){var n,i,a;const s=JSON.parse(e);if(!s||!s.userProfile||!s.userProfile.location)return;const c=s.userProfile,l=(0,d.Le)(c.location),f=c.locationSettingMode?Number(c.locationSettingMode):1,g=this.getCurrentState().profile||{};g.detectedLocation=c.detectedLocation&&(0,d.Le)(c.detectedLocation),g.followedLocations=(0,h.Td)(c.followedLocations&&c.followedLocations.map((e=>(0,d.Le)(e)))),g.sig=c.sig,null===(n=r.updateWeatherUserProfile.getActionSender(this))||void 0===n||n.send(g),t&&s.responses&&s.responses[0]&&s.responses[0].weather&&s.responses[0].weather[0]&&(s.responses[0].weather[0].disableFreshCheck=!0);const v=(0,d.zo)(s,l);if(!v||!v.unit)return;const p=v.unit;null===(i=r.updateLocationDetectionState.getActionSender(this))||void 0===i||i.send(f,l),null===(a=r.fetchWeatherSummarySuccess.getActionSender(this))||void 0===a||a.send(v,l,p,u.SU.WCComplete),this.getWeatherLocationAndUnit||(this.getWeatherLocationAndUnit=new Promise((e=>(0,o.mG)(this,void 0,void 0,(function*(){e([l,p])})))),ae.getWeatherLocationAndUnitTime=Date.now())}getURLLatLngLocation(){const e=(0,v.Nd)(this.requestContext.data.locationHref,"locationHref"),t=new URL(e),n={latitude:t.searchParams.get("lat")||"",longitude:t.searchParams.get("lon")||""};return(0,s.CR)(n)?n:null}getBLISLocation(){return(0,o.mG)(this,void 0,void 0,(function*(){let e=(yield this.pdpserviceClient.getBLISLocation())||(0,s.qE)();return(0,l.JY)(e)||(e=this.config.defaultLocation),e}))}setRecentLocations(e){(0,y.$o)().supported&&(0,y.$o)().setItem(u.Br,JSON.stringify(e))}getWeather(e,t,n){return(0,o.mG)(this,void 0,void 0,(function*(){const i=yield this.serviceClient.getWeather(e,t,n);return i&&i.forecast?i:null}))}hideWeatherCard(){var e;null===(e=r.hideWeatherCard.getActionSender(this))||void 0===e||e.send()}updateLocationDetectionState(e,t){var n;null===(n=r.updateLocationDetectionState.getActionSender(this))||void 0===n||n.send(e,t)}upLocation(e,t=!0,n=!0){var i,a;return(0,o.mG)(this,void 0,void 0,(function*(){const o=(null===(i=this.getCurrentState().profile)||void 0===i?void 0:i.followedLocations)||[],u=((null==o?void 0:o.filter((t=>(0,s.G)(e,t))))||[]).slice(0,c.E9-1);return null===(a=r.updateWeatherUserProfile.getActionSender(this))||void 0===a||a.send({home:e,followedLocations:[e,...u]}),t&&this.updateWeather(e),!n||(yield this.setLocationHome(e))}))}sendFetchWeatherSummaryFailureAction(){var e;null===(e=r.fetchWeatherSummaryFailure.getActionSender(this))||void 0===e||e.send(w.z$F)}setLocationHome(e){var t;return(0,o.mG)(this,void 0,void 0,(function*(){const n=yield this.operation.setHome(e);return n||null===(t=r.updateOperationFailure.getActionSender(this))||void 0===t||t.send(u.Uh.setHomeFail),n}))}updateWeather(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){return yield this.operation.updateWeather(e,t)}))}updateHyperlocal(){var e,t;return(0,o.mG)(this,void 0,void 0,(function*(){if((null===(e=this.config.weatherApi)||void 0===e?void 0:e.includenowcasting)&&(null===(t=this.config.autoSuggest)||void 0===t?void 0:t.useV6)){const e=this.getCurrentState().currentLocation;this.checkLocationHyper().then((t=>{var n;null!==t&&(N.M0.sendClientLogEvent({message:`Visited location with name ${a.Gf(e)}, hyperlocal check: ${t}`,type:"information"}),a.dP(e,this.getCurrentState().currentLocation)&&(null===(n=r.updateHyperlocal.getActionSender(this))||void 0===n||n.send(!!t)))}))}}))}checkLocationHyper(){return(0,o.mG)(this,void 0,void 0,(function*(){const e=this.getCurrentState().currentLocation;if((0,f.Ic)(e))return(0,f.FS)(e);{const t=a.Gf(e);if(this.locationHyperCache.has(t))return this.locationHyperCache.get(t);this.locationHyperCache.set(t,null);const n=yield this.getAutoSuggestResponse(t,!1);if(n){for(const i of n)if(a.dP(i,e)||a.Gf(i)===t){const e=(0,f.FS)(i);return this.locationHyperCache.set(t,e),e}this.locationHyperCache.set(t,!1)}return!1}}))}toggleFeedbackDialog(e){var t;null===(t=r.toggleFeedbackDialog.getGlobalActionSender())||void 0===t||t.send(e)}}var se=n(30856);function ce(e){if(e.currentLocation){const t=(0,c.sE)(e.profile,e.currentLocation.latitude,e.currentLocation.longitude);t&&(t.displayName=a.Gf(e.currentLocation))}}class ue{constructor(){this.INITIAL_STATE={locationDetectionSetting:2,unit:void 0,showLocationPanel:!0,profile:{},pollenSelectedDateIndex:0,layoutType:"",dateInfo:{},pollenCities:void 0}}reduce(e,t){if(!e)return this.INITIAL_STATE;if(!t)return e;let n=!1,i=null;return n=n||se.G.handleAction(t,r.fetchWeatherSummarySuccess,((t,n,r,o)=>{i=function(e,t,n,i,r){const o=Object.assign({},e);o.previews=t.previews,o.currentCondition=t.currentCondition,o.forecast=t.forecast,o.pollenForecast=t.pollen,o.nowcasting=t.nowcasting,o.lastUpdated=t.lastUpdated,o.alertsInfo=t.alertsInfo,o.alertsInfoList=t.alertsInfoList,o.contentData=t.contentData,o.mapsMetaData=t.mapsMetaData,o.source=t.source,o.provider=t.provider,o.aqiProvider=t.aqiProvider,o.lifeDaily=t.lifeDaily,o.activityIndexDaily=t.activityIndexDaily,(0,l.JY)(n)||(n=e.currentLocation);o.currentLocation=Object.assign({},n),ce(o),o.unit=i,r&&(o.settingUpdateStatus=r);o.currentLocation&&o.currentCondition&&o.locationWeatherMap&&(o.locationWeatherMap[(0,s._v)(o.currentLocation)]={currentTemperature:o.currentCondition.currentTemperature,pvdrIcon:o.currentCondition.pvdrIcon,symbol:o.currentCondition.symbol,alertCount:o.currentCondition.alertCount,alertSignificance:o.currentCondition.alertSignificance,cap:o.currentCondition.shortCap});return o}(e,t,n,r,o)})),n=n||se.G.handleAction(t,r.updateLocationDisplayName,(t=>{i=Object.assign({},e),a.dP(e.currentLocation,t)&&(i.currentLocation=Object.assign(Object.assign({},t),{displayName:a.Gf(t)}),ce(i))})),n=n||se.G.handleAction(t,r.updateLocationDetectionState,((t,n,r)=>{i=Object.assign({},e),i.locationDetectionSetting=t,i.currentLocation=n,i.settingUpdatedTime=r,ce(i)})),n=n||se.G.handleAction(t,r.updateWeatherSettings,(t=>{i=Object.assign({},e),i.settingUpdateStatus=t})),n=n||se.G.handleAction(t,r.updateWeatherUserProfile,(t=>{var n;i=Object.assign({},e),i.profile=Object.assign(Object.assign(Object.assign({},e.profile),t),{home:t.home||(null===(n=e.profile)||void 0===n?void 0:n.home)||void 0}),i.profile.home&&e.currentLocation&&a.dP(i.profile.home,e.currentLocation)&&(i.currentLocation=Object.assign(Object.assign({},i.currentLocation),{from:3})),ce(i)})),n=n||se.G.handleAction(t,r.updateOperationFailure,(t=>{i=Object.assign(Object.assign({},e),{operationFailureId:t})})),n=n||se.G.handleAction(t,r.hideWeatherCard,(()=>{i=Object.assign(Object.assign({},e),{weatherCardGotHiddenInFeed:!0})})),i||e}}const le={experienceConfigSchema:{}}},46102:function(e,t,n){n.d(t,{bc:function(){return s},y6:function(){return c}});var i,r,o=n(73252);!function(e){e.Map="weather::weathermaps",e.MonthlyForecast="weather::weathermonthlyforecast",e.Weather="weather",e.Forecast="weather::weathertoday",e.RecordsAndAveragesPage="weather::weatherrecordsandaverages",e.Life="weather::weatherlife",e.Pollen="weather::weatherpollen",e.HourlyForecast="weather::weatherhourlyforecast"}(i||(i={})),function(e){e[e.Forecast=1]="Forecast",e[e.Map=2]="Map",e[e.MonthlyForecast=3]="MonthlyForecast",e[e.RecordsAndAveragesPage=4]="RecordsAndAveragesPage",e[e.Pollen=5]="Pollen",e[e.Life=6]="Life",e[e.HourlyForecast=7]="HourlyForecast"}(r||(r={}));function a(){var e;return"weather::weathermaps"===(null===(e=o.Al.ClientSettings)||void 0===e?void 0:e.pagetype)}function s(){var e;return"weather::weatherhourlyforecast"===(null===(e=o.Al.ClientSettings)||void 0===e?void 0:e.pagetype)}function c(){return a()?2:"weather::weathermonthlyforecast"===(null===(e=o.Al.ClientSettings)||void 0===e?void 0:e.pagetype)?3:function(){var e;return"weather::weatherrecordsandaverages"===(null===(e=o.Al.ClientSettings)||void 0===e?void 0:e.pagetype)}()?4:function(){var e;return"weather::weatherlife"===(null===(e=o.Al.ClientSettings)||void 0===e?void 0:e.pagetype)}()?6:function(){var e;return"weather::weatherpollen"===(null===(e=o.Al.ClientSettings)||void 0===e?void 0:e.pagetype)}()?5:s()?7:1;var e}},17793:function(e,t,n){n.d(t,{Dx:function(){return r},Mv:function(){return o},Td:function(){return a}});var i=n(38573);function r(e,t){if(!t)return e;e=e||[];const n=[Object.assign({},t),...e],r={},o=[];for(let e=0;e<n.length;++e){const t=(0,i.Gf)(n[e]),a=`${n[e].latitude},${n[e].longitude}`;r[t]||r[a]||(o.push(n[e]),r[t]=e+1,r[a]=e+1)}return o}function o(e,t){if(!e||!t)return e;for(let n=0;n<e.length;++n)if((0,i.Gf)(e[n])===(0,i.Gf)(t)||e[n].latitude===t.latitude&&e[n].longitude===t.longitude){e.splice(n,1);break}return e}function a(e){if(!e)return[];const t=new Set,n=[];for(const r of e){const e=(0,i.Gf)(r);t.has(e)||(t.add(e),n.push(r))}return n}},29422:function(e,t,n){n.d(t,{Gf:function(){return s},Or:function(){return a},dP:function(){return o}});var i=n(38573),r=n(38985);function o(e,t,n=!1){return(0,r.dP)(e,t,n)}function a(e){if(e){if(e.autoSuggestionName)return e.autoSuggestionName;const t={enforceSmallLocaleFirst:!0};return(0,i.zl)(e,t)}}function s(e,t){return(0,i.Gf)(e,t)}},51325:function(e,t,n){n.d(t,{VO:function(){return o},qB:function(){return a}});var i=n(65337);const r="miniapp_detected_loc";function o(e){(0,i.$o)().setItem(r,JSON.stringify(e||{}))}function a(){const e=(0,i.$o)().getItem(r);if(e)return JSON.parse(e)}},66900:function(e,t,n){n.d(t,{BG:function(){return h},Hu:function(){return d},aS:function(){return f},wf:function(){return g}});var i=n(80368),r=n(12037),o=n(38573),a=n(84169),s=n(51325),c=n(12884);const u=/^.*(?:we-city-|\/)(-?\d*\.\d+),(-?\d*\.\d+)[\D]*$/,l=/\/in-([^/]+)$/;function d(e){if(!e)return;const t=e.searchParams||new URLSearchParams(e.search),n=e.pathname,a=(0,i.Ol)(e.searchParams,"el");if(a)return{el:a};const s=(0,i.Ol)(e.searchParams,"loc");let c={};if(s&&(c=r.v(s)),!c.latitude&&!c.longitude){const e=u.exec(n);e&&(c.latitude=e[1],c.longitude=e[2])}if(!c.latitude&&!c.longitude){const t=((0,i.Ol)(e.searchParams,"q")||"").split(",");if(2===t.length){const e={latitude:""+parseFloat(t[0]),longitude:""+parseFloat(t[1])};(0,o.JY)(e)&&(c=Object.assign(Object.assign({},c),e))}}return c.latitude||c.longitude||(c.latitude=(0,i.Ol)(e.searchParams,"lat"),c.longitude=(0,i.Ol)(e.searchParams,"lon")),c.latitude&&c.longitude&&(c=Object.assign(Object.assign(Object.assign({},c),(0,o.br)(c.latitude,c.longitude)),(0,o.$i)((0,i.Ol)(t,"weaext0"))||{})),(0,o.JY)(c)?c:void 0}function h(e){const t=l.exec(e.pathname);if(t)try{return decodeURIComponent(t[1])}catch(e){}}function f(e){const t=(0,i.Ol)(e.searchParams,"miniapp-loc");if(t)return r.v(t)}function g(e){try{if(!a.jG.isMiniProgram)return!1;let t=(0,s.qB)();if(!t||null==(null==t?void 0:t.longitude)||null==(null==t?void 0:t.latitude)){const e=(0,c.l4)(),n=new URL(e);n.searchParams.has("miniapp-loc")&&(t=f(n),(0,s.VO)(t))}return(0,o.XA)(t,e)}catch(e){return console.log("err",e),!1}}},24787:function(e,t,n){n.d(t,{By:function(){return u},E9:function(){return l},LV:function(){return f},Oj:function(){return y},Vn:function(){return p},qF:function(){return v},qq:function(){return h},sE:function(){return m}});var i=n(30854),r=n(29422),o=n(17793),a=n(84169),s=n(65337),c=n(38573);const u=10,l=a.jG.isMobile?20:10;function d(e){return!!e&&"null"!==e&&"undefined"!==e&&"false"!==e}function h(e,t=u){if(e.home&&((0,o.Mv)(e.favorites,e.home),(0,o.Mv)(e.recents,e.home)),e.favorites){e.favorites=f(e.favorites),e.favorites=e.favorites.slice(0,t);for(let t=0,n=e.favorites.length;t<n;++t)(0,o.Mv)(e.recents,e.favorites[t])}else void 0===e.favorites&&(e.favorites=[]);return e.recents?(e.recents=f(e.recents),e.recents=e.recents.filter((e=>"JP"!==e.isoCode||d(e.locality)||d(e.region))),e.recents=e.recents.slice(0,l)):void 0===e.recents&&(e.recents=[]),e.followedLocations?e.followedLocations=f(e.followedLocations):e.followedLocations=[],e}function f(e){return g(e,!0)}function g(e,t){if(!e)return[];const n=[],i=new Set,o=new Set;for(const a of e){if(!a)continue;const e=(0,r.Gf)(a),s=(0,c.aQ)(a);t&&i.has(e)||o.has(s)||(i.add(e),o.add(s),n.push(a))}return n}function v(e,t,n=u){let i=(0,o.Dx)(e.favorites,t),r=(0,o.Mv)(e.recents,t);return i&&i.length>n&&(i=i.slice(0,n)),r&&r.length>l&&(r=r.slice(0,l)),e.favorites=i,e.recents=r,e}function p(e,t){return e.recents=(0,o.Dx)(e.recents,t),h(e)}function m(e,t,n){const i=[];return e&&(i.push(e.home),Array.prototype.push.apply(i,e.favorites||[]),Array.prototype.push.apply(i,e.recents||[])),i.filter((e=>!!e&&e.latitude===t&&e.longitude===n))[0]}function y(e,t){if(!a.jG.isMobile)return[];let n=(0,o.Dx)(e.recentsForMobile,t);const r=l;var c;return n?(n=n.filter((e=>"JP"!==e.isoCode||d(e.locality)||d(e.region))),n=n.slice(0,r)):void 0===n&&(n=[]),c=n,(0,s.$o)().supported&&(0,s.$o)().setItem(i.n3,JSON.stringify(c)),n}},19628:function(e,t){var n=function(){function e(){}return e.IsNullOrWhiteSpace=function(e){try{return null==e||"undefined"==e||e.toString().replace(/\s/g,"").length<1}catch(e){return console.log(e),!1}},e.Join=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];try{var r=n[0];if(Array.isArray(r)||r instanceof Array){for(var o=e.Empty,a=0;a<r.length;a++){var s=r[a];a<r.length-1?o+=s+t:o+=s}return o}if("object"==typeof r){var c=e.Empty,u=r;return Object.keys(r).forEach((function(e){c+=u[e]+t})),c=c.slice(0,c.length-t.length)}var l=n;return e.join.apply(e,[t].concat(l))}catch(t){return console.log(t),e.Empty}},e.Format=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];try{return t.match(e.regexNumber)?e.format(e.regexNumber,t,n):t.match(e.regexObject)?e.format(e.regexObject,t,n,!0):e.Empty}catch(t){return console.log(t),e.Empty}},e.format=function(t,n,i,r){return void 0===r&&(r=!1),n.replace(t,(function(t,n){var o,a=t.split(":");return a.length>1&&(n=a[0].replace("{",""),t=a[1].replace("}","")),null==(o=r?i[0][n]:i[n])||null==o||t.match(/{\d+}/)||void 0!==(o=e.parsePattern(t,o))&&null!=o?o:e.Empty}))},e.parsePattern=function(t,n){switch(t){case"L":return n.toLowerCase();case"U":return n.toUpperCase();case"d":if("string"==typeof n)return e.getDisplayDateFromString(n);if(n instanceof Date)return e.Format("{0:00}.{1:00}.{2:0000}",n.getDate(),n.getMonth(),n.getFullYear());break;case"s":if("string"==typeof n)return e.getSortableDateFromString(n);if(n instanceof Date)return e.Format("{0:0000}-{1:00}-{2:00}",n.getFullYear(),n.getMonth(),n.getDate());break;case"n":"string"!=typeof n&&(n=n.toString());var i=n.replace(/,/g,".");if(isNaN(parseFloat(i))||i.length<=3)break;var r=i.split(/[^0-9]+/g),o=r;r.length>1&&(o=[e.join.apply(e,[""].concat(r.splice(0,r.length-1))),r[r.length-1]]);var a=o[0],s=a.length%3,c=s>0?a.substring(0,s):e.Empty,u=a.substring(s).match(/.{3}/g);return(c=c+"."+e.Join(".",u))+(o.length>1?","+o[1]:"")}return"number"!=typeof n&&isNaN(n)||isNaN(+t)||e.IsNullOrWhiteSpace(n)?n:e.formatNumber(n,t)},e.getDisplayDateFromString=function(e){var t;if((t=e.split("-")).length<=1)return e;var n=t[t.length-1],i=t[t.length-2],r=t[t.length-3];return(n=(n=n.split("T")[0]).split(" ")[0])+"."+i+"."+r},e.getSortableDateFromString=function(t){var n=t.replace(",","").split(".");if(n.length<=1)return t;var i=n[n.length-1].split(" "),r=e.Empty;i.length>1&&(r=i[i.length-1]);var o=n[n.length-1].split(" ")[0]+"-"+n[n.length-2]+"-"+n[n.length-3];return!e.IsNullOrWhiteSpace(r)&&r.length>1?o+="T"+r:o+="T00:00:00",o},e.formatNumber=function(e,t){var n=t.length,i=e.toString();if(n<=i.length)return i;var r=n-i.length;return new Array(r+=1).join("0")+i},e.join=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];for(var r=e.Empty,o=0;o<n.length;o++)if(!("string"==typeof n[o]&&e.IsNullOrWhiteSpace(n[o])||"number"!=typeof n[o]&&"string"!=typeof n[o])){r+=""+n[o];for(var a=o+1;a<n.length;a++)if(!e.IsNullOrWhiteSpace(n[a])){r+=t,o=a-1;break}}return r},e.regexNumber=/{(\d+(:\w*)?)}/g,e.regexObject=/{(\w+(:\w*)?)}/g,e.Empty="",e}();t.Ld=n;var i=function(){function e(e){void 0===e&&(e=n.Empty),this.Values=[],this.Values=new Array(e)}return e.prototype.ToString=function(){return this.Values.join("")},e.prototype.Append=function(e){this.Values.push(e)},e.prototype.AppendFormat=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.Values.push(n.Format.apply(n,[e].concat(t)))},e.prototype.Clear=function(){this.Values=[]},e}()},49977:function(e,t,n){n.d(t,{EQ:function(){return D},P:function(){return O}});var i=Symbol("@ts-pattern/matcher"),r="@ts-pattern/anonymous-select-key",o=function(e){return Boolean(e&&"object"==typeof e)},a=function(e){return e&&!!e[i]},s=function e(t,n,r){if(o(t)){if(a(t)){var s=t[i]().match(n),c=s.matched,u=s.selections;return c&&u&&Object.keys(u).forEach((function(e){return r(e,u[e])})),c}if(!o(n))return!1;if(Array.isArray(t))return!!Array.isArray(n)&&t.length===n.length&&t.every((function(t,i){return e(t,n[i],r)}));if(t instanceof Map)return n instanceof Map&&Array.from(t.keys()).every((function(i){return e(t.get(i),n.get(i),r)}));if(t instanceof Set){if(!(n instanceof Set))return!1;if(0===t.size)return 0===n.size;if(1===t.size){var l=Array.from(t.values())[0];return a(l)?Array.from(n.values()).every((function(t){return e(l,t,r)})):n.has(l)}return Array.from(t.values()).every((function(e){return n.has(e)}))}return Object.keys(t).every((function(o){var s,c=t[o];return(o in n||a(s=c)&&"optional"===s[i]().matcherType)&&e(c,n[o],r)}))}return Object.is(n,t)},c=function e(t){var n,r,s;return o(t)?a(t)?null!=(n=null==(r=(s=t[i]()).getSelectionKeys)?void 0:r.call(s))?n:[]:Array.isArray(t)?u(t,e):u(Object.values(t),e):[]},u=function(e,t){return e.reduce((function(e,n){return e.concat(t(n))}),[])};function l(e){var t;return(t={})[i]=function(){return{match:function(t){var n={},i=function(e,t){n[e]=t};return void 0===t?(c(e).forEach((function(e){return i(e,void 0)})),{matched:!0,selections:n}):{matched:s(e,t,i),selections:n}},getSelectionKeys:function(){return c(e)},matcherType:"optional"}},t}function d(e){var t;return(t={})[i]=function(){return{match:function(t){if(!Array.isArray(t))return{matched:!1};var n={};if(0===t.length)return c(e).forEach((function(e){n[e]=[]})),{matched:!0,selections:n};var i=function(e,t){n[e]=(n[e]||[]).concat([t])};return{matched:t.every((function(t){return s(e,t,i)})),selections:n}},getSelectionKeys:function(){return c(e)}}},t}function h(){var e,t=[].slice.call(arguments);return(e={})[i]=function(){return{match:function(e){var n={},i=function(e,t){n[e]=t};return{matched:t.every((function(t){return s(t,e,i)})),selections:n}},getSelectionKeys:function(){return u(t,c)},matcherType:"and"}},e}function f(){var e,t=[].slice.call(arguments);return(e={})[i]=function(){return{match:function(e){var n={},i=function(e,t){n[e]=t};return u(t,c).forEach((function(e){return i(e,void 0)})),{matched:t.some((function(t){return s(t,e,i)})),selections:n}},getSelectionKeys:function(){return u(t,c)},matcherType:"or"}},e}function g(e){var t;return(t={})[i]=function(){return{match:function(t){return{matched:!s(e,t,(function(){}))}},getSelectionKeys:function(){return[]},matcherType:"not"}},t}function v(e){var t;return(t={})[i]=function(){return{match:function(t){return{matched:Boolean(e(t))}}}},t}function p(){var e,t=[].slice.call(arguments),n="string"==typeof t[0]?t[0]:void 0,o=2===t.length?t[1]:"string"==typeof t[0]?void 0:t[0];return(e={})[i]=function(){return{match:function(e){var t,i=((t={})[null!=n?n:r]=e,t);return{matched:void 0===o||s(o,e,(function(e,t){i[e]=t})),selections:i}},getSelectionKeys:function(){return[null!=n?n:r].concat(void 0===o?[]:c(o))}}},e}var m=v((function(e){return!0})),y=m,S=v((function(e){return"string"==typeof e})),L=v((function(e){return"number"==typeof e})),w=v((function(e){return"boolean"==typeof e})),C=v((function(e){return"bigint"==typeof e})),A=v((function(e){return"symbol"==typeof e})),b=v((function(e){return null==e})),O={__proto__:null,optional:l,array:d,intersection:h,union:f,not:g,when:v,select:p,any:m,_:y,string:S,number:L,boolean:w,bigint:C,symbol:A,nullish:b,instanceOf:function(e){return v(function(e){return function(t){return t instanceof e}}(e))},typed:function(){return{array:d,optional:l,intersection:h,union:f,not:g,select:p,when:v}}};function D(e){return new F(e,[])}var F=function(){function e(e,t){this.value=void 0,this.cases=void 0,this.value=e,this.cases=t}var t=e.prototype;return t.with=function(){var t=[].slice.call(arguments),n=t[t.length-1],i=[t[0]],o=[];return 3===t.length&&"function"==typeof t[1]?(i.push(t[0]),o.push(t[1])):t.length>2&&i.push.apply(i,t.slice(1,t.length-1)),new e(this.value,this.cases.concat([{match:function(e){var t={},n=Boolean(i.some((function(n){return s(n,e,(function(e,n){t[e]=n}))}))&&o.every((function(t){return t(e)})));return{matched:n,value:n&&Object.keys(t).length?r in t?t[r]:t:e}},handler:n}]))},t.when=function(t,n){return new e(this.value,this.cases.concat([{match:function(e){return{matched:Boolean(t(e)),value:e}},handler:n}]))},t.otherwise=function(t){return new e(this.value,this.cases.concat([{match:function(e){return{matched:!0,value:e}},handler:t}])).run()},t.exhaustive=function(){return this.run()},t.run=function(){for(var e=this.value,t=void 0,n=0;n<this.cases.length;n++){var i=this.cases[n],r=i.match(this.value);if(r.matched){e=r.value,t=i.handler;break}}if(!t){var o;try{o=JSON.stringify(this.value)}catch(e){o=this.value}throw new Error("Pattern matching error: no pattern matches value "+o)}return t(e,this.value)},e}()}}]);