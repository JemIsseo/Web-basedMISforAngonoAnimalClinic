(self.webpackChunk_msnews_msnews_experiences=self.webpackChunk_msnews_msnews_experiences||[]).push([["RewardsCoachmarkData"],{74034:function(e,t,o){"use strict";o.r(t),o.d(t,{RewardsCoachmarkDataConnector:function(){return _},RewardsCoachmarkDataReducer:function(){return w},ToolingInfo:function(){return O},localRewardsCoachmarks:function(){return n},mockConfig:function(){return v.mockConfig}});var i,n,a=o(40889),r=o(33940),s=o(86331),c=o(87230);!function(e){e.ENUS_infomode_switch_keep_s1_100="ENUS_infomode_switch_keep_s1_100",e.ENUS_infomode_switch_keep_s2_400="ENUS_infomode_switch_keep_s2_400"}(i||(i={})),function(e){e.informationalSwitchOffer="informationalSwitchOffer",e.informationalSwitchCompletion="informationalSwitchCompletion",e.informationalKeepCompletion="informationalKeepCompletion"}(n||(n={}));var f=o(65337),m=o(81555),l=o(9533),h=o(53076),d=o(63439),g=o(93450),u=o(55067);class C{}C.setActiveCoachmark=new u.C("SetActiveCoachmark");var p=o(26415),k=o(65135);class _ extends d.e{constructor(e,t,o,i,n,a,r){super(e,t,o,i,n,a,r)}addRewardsCoachmarks(e){return(0,r.mG)(this,void 0,void 0,(function*(){e&&e.length?(yield this.getChromiumPageSettingsConnector(),this.populateLocalRewardsOffers(e),this.addInformationalCoachmarks()):k.M0.sendAppErrorEvent(Object.assign(Object.assign({},p._QI.OffersUndefined),{message:"Offers is not defined"}))}))}addFollowOnCoachmarksForOffer(e,t){return(0,r.mG)(this,void 0,void 0,(function*(){e&&this.config&&this.config.followOnCoachmarksForOffers&&this.config.followOnCoachmarksForOffers[e]&&this.addLocalCoachmark(e,this.config.followOnCoachmarksForOffers[e],t)}))}addInformationalCoachmarks(){var e;return(0,r.mG)(this,void 0,void 0,(function*(){if(!this.informationalOfferStatus)return;if(!this.config||!this.config.localCoachMarks||!this.config.localCoachMarks[n.informationalSwitchOffer])return;if(this.config.enableStampingFromLocalStorage&&this.checkStorageAndStampTmplForControl(n.informationalSwitchOffer),this.informationalOfferStatus.informationalSwitchCompleted)return;const t=null===(e=this.chromiumPageSettingsConnector)||void 0===e?void 0:e.getCurrentState();t&&t.configData&&t.configData.inPageSearchBoxType?t&&t.selectedFeedDisplaySetting&&"always"!==t.selectedFeedDisplaySetting&&this.addLocalCoachmark(i.ENUS_infomode_switch_keep_s1_100,s.gz.informationalSwitchOffer):k.M0.sendAppErrorEvent(Object.assign(Object.assign({},p._QI.PageSettingsUndefined),{message:"PageSettings or inPageSearchBoxType not defined"}))}))}addLocalCoachmark(e,t,o){return(0,r.mG)(this,void 0,void 0,(function*(){if(!(e&&t&&this.config&&this.config.localCoachMarks&&this.config.localCoachMarks[t]&&m._))return;const i=this.config.localCoachMarks[t];if(i.requiresTMPLMarking&&(k.M0.addOrUpdateTmplProperty(i.tmplProperty,"1"),this.config.enableStampingFromLocalStorage&&(0,f.$o)().setItem(`${i.tmplProperty}_Stamped`,"true")),!i.enabled)return;const n={coachmarkName:t,offerId:e};if(C.setActiveCoachmark.getActionSender(this).send(n),!i.targetingElementKey)return void k.M0.sendAppErrorEvent(Object.assign(Object.assign({},p._QI.ConfigNotPassed),{message:`elementKey missing in config for ${t}`}));const a=yield(0,l.h_)(i.targetingElementKey);i.delayLoadCoachmarkInMs&&(yield this.delay(i.delayLoadCoachmarkInMs));const r=c.W.getInstance();r.registrations.register(t).registerItemAnchorElement(a),o&&r.registrations.register(t).registerDisplayCallback(o),r.triggerCoachMark(t,{parentCampaignId:e})}))}getChromiumPageSettingsConnector(){return(0,r.mG)(this,void 0,void 0,(function*(){const e=yield g._.getInstance().rootReducer.getDataConnector(h.z.ChromiumPageSettings);this.chromiumPageSettingsConnector=e}))}populateLocalRewardsOffers(e){if(!e||!e.length)return;const t=e.find((e=>e.offerId===i.ENUS_infomode_switch_keep_s1_100));if(t){const o=e.find((e=>e.offerId===i.ENUS_infomode_switch_keep_s2_400));this.informationalOfferStatus={informationalSwitchCompleted:"True"===t.isComplete,informationalKeepCompleted:"True"===(null==o?void 0:o.isComplete),informationalSwitchCompletionTime:t.CompletionDate?new Date(t.CompletionDate):null}}}checkStorageAndStampTmplForControl(e){if(!(e&&this.config&&this.config.localCoachMarks&&this.config.localCoachMarks[e]))return;if(!this.config.localCoachMarks[e].requiresTMPLMarking)return;const t=this.config.localCoachMarks[e].tmplProperty,o=`${t}_Stamped`;(0,f.$o)().getItem(o)&&k.M0.addOrUpdateTmplProperty(t,"1")}delay(e){return(0,r.mG)(this,void 0,void 0,(function*(){return new Promise((t=>window.setTimeout(t,e)))}))}}var S=o(30856);class w{reduce(e,t){if(!e)return{activeCoachmark:void 0};if(!t)return e;let o=Object.assign({},e),i=!1;return i=i||S.G.handleAction(t,C.setActiveCoachmark,(t=>(o=Object.assign(Object.assign({},e),{activeCoachmark:t}),o))),o}}var v=o(34988);const O={experienceConfigSchema:a.RewardsCoachmarkDataConfigSchema,mockConfig:v.mockConfig,defaultMockState:{},mockState:[]}},34988:function(){},40889:function(){}}]);